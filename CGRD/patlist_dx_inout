目的: 從門診或住院抓取特定診斷之病人清單
範例: select * from patlist_dx_inout('676,250');


CREATE OR REPLACE FUNCTION patlist_dx_inout(
	codes TEXT)
	RETURNS table (
		idcode varchar
	) 
	LANGUAGE 'plpgsql'

AS $body$

BEGIN
	RETURN QUERY
	SELECT a.idcode
	FROM op_diag a
	WHERE dssid in (SELECT regexp_split_to_table(codes,E',')) 	
	UNION
	
	SELECT b.idcode
	FROM ip_icd b
	WHERE dxkd1 in (SELECT regexp_split_to_table(codes,E',')) or 
		  dxkd2 in (SELECT regexp_split_to_table(codes,E',')) or
		  dxkd3 in (SELECT regexp_split_to_table(codes,E',')) or
		  dxkd4 in (SELECT regexp_split_to_table(codes,E',')) or
		  dxkd5 in (SELECT regexp_split_to_table(codes,E','))
	limit 10
	;
	--RETURN idcode;	
END;
$body$

select * from patlist_dx_inout('676,250');
